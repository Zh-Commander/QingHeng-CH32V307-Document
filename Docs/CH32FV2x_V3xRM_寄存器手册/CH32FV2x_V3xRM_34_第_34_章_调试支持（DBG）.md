# 第 34 章 调试支持（DBG）

## 34.1 主要特征

此寄存器允许在调试状态下配置MCU。包括：

支持独立看门狗（IWDG）的计数器  
$\bullet$ 支持窗口看门狗（WWDG）的计数器  
$\bullet$ 支持定时器的计数器  
$\bullet$ 支持 I2CSMBus 的超时控制  
支持 bxCAN 通信

## 34.2 寄存器描述

### 34.2.1 RISC-V 调试 MCU 配置寄存器（DBGMCU_CR）

地址： $0 \times 7 0 0$ (CSR)

<table><tr><td colspan="8">Reserved</td><td>TIM10STOP</td><td>TIM9STOP</td><td>CAN2STOP</td><td>CAN1STOP</td><td>TIM8STOP</td><td>TIM7STOP</td><td>TIM6STOP</td><td>TIM5STOP</td></tr><tr><td>15</td><td>14</td><td>13</td><td>12</td><td>11</td><td>10</td><td>9</td><td>8</td><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td></tr><tr><td>TIM4_STOP</td><td>TIM3_STOP</td><td>TIM2_STOP</td><td>TIM1_STOP</td><td>I2C2_SMBUS_TIME_OUT</td><td>I2C1_SMBUS_TIME_OUT</td><td>WWDG_STOP</td><td>IWDG_STOP</td><td colspan="5">Reserved</td><td>STAND_BY</td><td>STOP</td><td>SLEEP</td></tr></table>

<table><tr><td>位</td><td>名称</td><td>访问</td><td>描述</td><td>复位值</td></tr><tr><td>[31:24]</td><td>Reserved</td><td>RW</td><td>保留</td><td></td></tr><tr><td>23</td><td>TIM10_STOP</td><td>RW</td><td>定时器10调试停止位。当内核进入调试状态时计数器停止工作。1: 定时器10的计数器停止工作;0: 定时器10的计数器仍然正常工作。</td><td>0</td></tr><tr><td>22</td><td>TIM9_STOP</td><td>RW</td><td>定时器9调试停止位。当内核进入调试状态时计数器停止工作。1: 定时器9的计数器停止工作;0: 定时器9的计数器仍然正常工作。</td><td>0</td></tr><tr><td>21</td><td>CAN2_STOP</td><td>RW</td><td>CAN2调试停止位。当内核进入调试状态时CAN2停止运行。1: CAN2的接收寄存器不继续接收数据;0: CAN2仍然正常运行。</td><td>0</td></tr><tr><td>20</td><td>CAN1_STOP</td><td>RW</td><td>CAN1调试停止位。当内核进入调试状态时CAN1停止运行。1: CAN1的接收寄存器不继续接收数据;0: CAN1仍然正常运行。</td><td>0</td></tr><tr><td>19</td><td>TIM8_STOP</td><td>RW</td><td>定时器8调试停止位。当内核进入调试状态时计数器停止工作。1: 定时器8的计数器停止工作;</td><td>0</td></tr><tr><td></td><td></td><td></td><td>0:定时器8的计数器仍然正常工作。</td><td></td></tr><tr><td>18</td><td>TIM7_STOP</td><td>RW</td><td>定时器7调试停止位。当内核进入调试状态时计数器停止工作。1:定时器7的计数器停止工作;0:定时器7的计数器仍然正常工作。</td><td>0</td></tr><tr><td>17</td><td>TIM6_STOP</td><td>RW</td><td>定时器6调试停止位。当内核进入调试状态时计数器停止工作。1:定时器6的计数器停止工作;0:定时器6的计数器仍然正常工作。</td><td>0</td></tr><tr><td>16</td><td>TIM5_STOP</td><td>RW</td><td>定时器5调试停止位。当内核进入调试状态时计数器停止工作。1:定时器5的计数器停止工作;0:定时器5的计数器仍然正常工作。</td><td>0</td></tr><tr><td>15</td><td>TIM4_STOP</td><td>RW</td><td>定时器4调试停止位。当内核进入调试状态时计数器停止工作。1:定时器4的计数器停止工作;0:定时器4的计数器仍然正常工作。</td><td>0</td></tr><tr><td>14</td><td>TIM3_STOP</td><td>RW</td><td>定时器3调试停止位。当内核进入调试状态时计数器停止工作。1:定时器3的计数器停止工作;0:定时器3的计数器仍然正常工作。</td><td>0</td></tr><tr><td>13</td><td>TIM2_STOP</td><td>RW</td><td>定时器2调试停止位。当内核进入调试状态时计数器停止工作。1:定时器2的计数器停止工作;0:定时器2的计数器仍然正常工作。</td><td>0</td></tr><tr><td>12</td><td>TIM1_STOP</td><td>RW</td><td>定时器1调试停止位。当内核进入调试状态时计数器停止工作。1:定时器1的计数器停止工作;0:定时器1的计数器仍然正常工作。</td><td>0</td></tr><tr><td>11</td><td>I2C2_SMBUS_TIMEOUT</td><td>RW</td><td>SMBUS超时模式调试停止位。当内核进入调试状态时停止SMBUS超时模式。1:冻结SMBUS的超时控制;0:与正常模式操作相同。</td><td>0</td></tr><tr><td>10</td><td>I2C1_SMBUS_TIMEOUT</td><td>RW</td><td>SMBUS超时模式调试停止位。当内核进入调试状态时停止SMBUS超时模式。1:冻结SMBUS的超时控制;0:与正常模式操作相同。</td><td>0</td></tr><tr><td>9</td><td>WWDG_STOP</td><td>RW</td><td>窗口看门狗调试停止位。当内核进入调试状态时调试窗口看门狗停止工作。1:窗口看门狗计数器停止工作;0:窗口看门狗计数器仍然正常工作。</td><td>0</td></tr><tr><td>8</td><td>IWDG_STOP</td><td>RW</td><td>独立看门狗调试停止位。当内核进入调试状态时看门狗停止工作。1:看门狗计数器停止工作;0:看门狗计数器仍然正常工作。</td><td>0</td></tr><tr><td>[7:3]</td><td>Reserved</td><td>RW</td><td>保留</td><td>0</td></tr><tr><td>2</td><td>STANDBY</td><td>RW</td><td>调试待机模式位。
1: (FCLK开, HCLK开)数字电路部分不下电, FCLK和 HCLK时钟由内部RL振荡器提供时钟。另外, 微控制器通过产生系统复位来退出STANDBY模式和复位是一样的;
0: (FCLK关, HCLK关)整个数字电路部分都断电。从软件的观点看, 退出STANDBY模式与复位是一样的(除了一些状态位指示了微控制器刚从STANDBY状态退出)。</td><td>0</td></tr><tr><td>1</td><td>STOP</td><td>RW</td><td>调试停止模式位。
1: (FCLK开, HCLK开)在停止模式时, FCLK和 HCLK时钟由内部RC振荡器提供。当退出停止模式时,软件必需重新配置时钟系统启动PLL, 晶振等(与配置此比特位为0时的操作一样);
0: (FCLK关, HCLK关)在停止模式时,时钟控制器禁止一切时钟(包括HCLK和FCLK)。当从STOP模式退出时,时钟的配置和复位之后的配置一样(微控制器由8MHz的内部RC振荡器(HIS)提供时钟)。因此,软件必需重新配置时钟控制系统启动PLL, 晶振等。</td><td>0</td></tr><tr><td>0</td><td>SLEEP</td><td>RW</td><td>调试睡眠模式位。
1: (FCLK开, HCLK开)在睡眠模式时, FCLK和 HCLK时钟都由原先配置好的系统时钟提供;
0: (FCLK开, HCLK关)在睡眠模式时, FCLK由原先已配置好的系统时钟提供, HCLK则关闭。由于睡眠模式不会复位已配置好的时钟系统,因此从睡眠模式退出时,软件不需要重新配置时钟系统。</td><td>0</td></tr></table>

注：适用于CH32V2x、CH32V3×系列。当系统进入调试模式之后，芯片具有某外设，调试模块则具有配置该外设的功能，调试MCU配置寄存器则具有该外设所对应的配置位。

### 34.2.2 ARM 调试 MCU 配置寄存器（DBGMCU_CR）

地址：0xE0042004

<table><tr><td colspan="9">Reserved</td><td>TIM10_STOP</td><td>TIM9_STOP</td><td>CAN2_STOP</td><td>TIM8_STOP</td><td>TIM7_STOP</td><td>TIM6_STOP</td><td>TIM5_STOP</td><td>I2C2_SMBUS_TIME_OUT</td></tr><tr><td>15</td><td>14</td><td>13</td><td>12</td><td>11</td><td>10</td><td>9</td><td>8</td><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td></td></tr><tr><td>I2C1_SMBUS_TIME_OUT</td><td>CAN1_STOP</td><td>TIM4_STOP</td><td>TIM3_STOP</td><td>TIM2_STOP</td><td>TIM1_STOP</td><td>WWDG_STOP</td><td>IWDG_STOP</td><td colspan="2">TRACE_MODE</td><td>TRACE_IOEN</td><td colspan="2">Reserved</td><td>STAND_BY</td><td>STOP</td><td>SLEEP</td><td></td></tr></table>

<table><tr><td>位</td><td>名称</td><td>访问</td><td>描述</td><td>复位值</td></tr><tr><td>[31:24]</td><td>Reserved</td><td>RW</td><td>保留</td><td></td></tr><tr><td>23</td><td>TIM10_STOP</td><td>RW</td><td>定时器 10 调试停止位。当内核进入调试状态时计</td><td>0</td></tr><tr><td></td><td></td><td></td><td>数器停止工作。1:定时器10的计数器停止工作;0:定时器10的计数器仍然正常工作。</td><td></td></tr><tr><td>22</td><td>TIM9_STOP</td><td>RW</td><td>定时器9调试停止位。当内核进入调试状态时计数器停止工作。1:定时器9的计数器停止工作;0:定时器9的计数器仍然正常工作。</td><td>0</td></tr><tr><td>21</td><td>CAN2_STOP</td><td>RW</td><td>CAN2调试停止位。当内核进入调试状态时CAN2停止运行。1:CAN2的接收寄存器不继续接收数据;0:CAN2仍然正常运行。</td><td>0</td></tr><tr><td>20</td><td>TIM8_STOP</td><td>RW</td><td>定时器8调试停止位。当内核进入调试状态时计数器停止工作。1:定时器8的计数器停止工作;0:定时器8的计数器仍然正常工作。</td><td>0</td></tr><tr><td>19</td><td>TIM7_STOP</td><td>RW</td><td>定时器7调试停止位。当内核进入调试状态时计数器停止工作。1:定时器7的计数器停止工作;0:定时器7的计数器仍然正常工作。</td><td>0</td></tr><tr><td>18</td><td>TIM6_STOP</td><td>RW</td><td>定时器6调试停止位。当内核进入调试状态时计数器停止工作。1:定时器6的计数器停止工作;0:定时器6的计数器仍然正常工作。</td><td>0</td></tr><tr><td>17</td><td>TIM5_STOP</td><td>RW</td><td>定时器5调试停止位。当内核进入调试状态时计数器停止工作。1:定时器5的计数器停止工作;0:定时器5的计数器仍然正常工作。</td><td>0</td></tr><tr><td>16</td><td>I2C2_SMBUS_TIMEOUT</td><td>RW</td><td>SMBUS超时模式调试停止位。当内核进入调试状态时停止SMBUS超时模式。1:冻结SMBUS的超时控制;0:与正常模式操作相同。</td><td>0</td></tr><tr><td>15</td><td>I2C1_SMBUS_TIMEOUT</td><td>RW</td><td>SMBUS超时模式调试停止位。当内核进入调试状态时停止SMBUS超时模式。1:冻结SMBUS的超时控制;0:与正常模式操作相同。</td><td>0</td></tr><tr><td>14</td><td>CAN1_STOP</td><td>RW</td><td>CAN1调试停止位。当内核进入调试状态时CAN1停止运行。1:CAN1的接收寄存器不继续接收数据;0:CAN1仍然正常运行。</td><td>0</td></tr><tr><td>13</td><td>TIM4_STOP</td><td>RW</td><td>定时器4调试停止位。当内核进入调试状态时计数器停止工作。1:定时器4的计数器停止工作;0:定时器4的计数器仍然正常工作。</td><td>0</td></tr><tr><td>12</td><td>TIM3_STOP</td><td>RW</td><td>定时器3调试停止位。当内核进入调试状态时计数器停止工作。1:定时器3的计数器停止工作;</td><td>0</td></tr><tr><td></td><td></td><td></td><td>0:定时器3的计数器仍然正常工作。</td><td></td></tr><tr><td>11</td><td>TIM2_STOP</td><td>RW</td><td>定时器2调试停止位。当内核进入调试状态时计数器停止工作。1:定时器2的计数器停止工作;0:定时器2的计数器仍然正常工作。</td><td>0</td></tr><tr><td>10</td><td>TIM1_STOP</td><td>RW</td><td>定时器1调试停止位。当内核进入调试状态时计数器停止工作。1:定时器1的计数器停止工作;0:定时器1的计数器仍然正常工作。</td><td>0</td></tr><tr><td>9</td><td>WWDG_STOP</td><td>RW</td><td>窗口看门狗调试停止位。当内核进入调试状态时调试窗口看门狗停止工作。1:窗口看门狗计数器停止工作;0:窗口看门狗计数器仍然正常工作。</td><td>0</td></tr><tr><td>8</td><td>IWDG_STOP</td><td>RW</td><td>独立看门狗调试停止位。当内核进入调试状态时看门狗停止工作。1:看门狗计数器停止工作;0:看门狗计数器仍然正常工作。</td><td>0</td></tr><tr><td>[7:6]</td><td>TRACE_MODE</td><td>RW</td><td>跟踪引脚分配控制位。该位和TRACE_IOEN配合使用。当TRACE_IOEN=0时:xx:不分配跟踪引脚(默认状态)。当TRACE_IOEN=1时:00:跟踪引脚使用异步模式;01:跟踪引脚使用同步模式,并且数据长度为1;10:跟踪引脚使用同步模式,并且数据长度为2;11:跟踪引脚使用同步模式,并且数据长度为4。</td><td>xx</td></tr><tr><td>5</td><td>TRACE_IOEN</td><td>RW</td><td>跟踪引脚分配使能位。该位和TRACE_MODE配合使用。0:不分配跟踪引脚(默认状态);1:分配跟踪引脚。</td><td>0</td></tr><tr><td>[4:3]</td><td>Reserved</td><td>RW</td><td>保留</td><td>0</td></tr><tr><td>2</td><td>STANDBY</td><td>RW</td><td>调试待机模式位。1:(FCLK开,HCLK开)数字电路部分不下电,FCLK和HCLK时钟由内部RL振荡器提供时钟。另外,微控制器通过产生系统复位来退出STANDBY模式和复位是一样的;0:(FCLK关,HCLK关)整个数字电路部分都断电。从软件的观点看,退出STANDBY模式与复位是一样的(除了一些状态位指示了微控制器刚从STANDBY状态退出)。</td><td>0</td></tr><tr><td>1</td><td>STOP</td><td>RW</td><td>调试停止模式位。1:(FCLK开,HCLK开)在停止模式时,FCLK和HCLK时钟由内部RC振荡器提供。当退出停止模式时,软件必需重新配置时钟系统启动PLL,晶振等(与配置此比特位为0时的操作一样);0:(FCLK关,HCLK关)在停止模式时,时钟控制器</td><td>0</td></tr><tr><td></td><td></td><td></td><td>禁止一切时钟(包括HCLK和FCLK)。当从STOP模式退出时,时钟的配置和复位之后的配置一样(微控制器由8MHz的内部RC振荡器(HIS)提供时钟)。因此,软件必需重新配置时钟控制系统启动PLL,晶振等。</td><td></td></tr><tr><td>0</td><td>SLEEP</td><td>RW</td><td>调试睡眠模式位。1:(FCLK开,HCLK开)在睡眠模式时,FCLK和HCLK时钟都由原先配置好的系统时钟提供;0:(FCLK开,HCLK关)在睡眠模式时,FCLK由原先已配置好的系统时钟提供,HCLK则关闭。由于睡眠模式不会复位已配置好的时钟系统,因此从睡眠模式退出时,软件不需要重新配置时钟系统。</td><td>0</td></tr></table>

注：适用于 ${ C H 3 2 F 2 x }$ 系列。当系统进入调试模式之后，芯片具有某外设，调试模块则具有配置该外设的功能，调试MCU配置寄存器则具有该外设所对应的配置位。