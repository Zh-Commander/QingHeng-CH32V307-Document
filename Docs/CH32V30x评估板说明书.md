# CH32V3xx 评估板说明及应用参考

版本：V1.9

https:// wch.cn

## 一、概述

本评估板应用于 CH32V30x/CH32V317 芯片的开发，IDE 使用 MounRiver 编译器，可选择使用板载或独立的 WCH-Link 进行仿真和下载，并提供了芯片资源相关的应用参考示例及演示。

## 二、评估板硬件

评估板的原理图请参考 CH32V307SCH.pdf 文档

![](images/f0820015f9a0f8ff51b4b31d003896709bf6a4e6eec7c810232b09f8d1ec22ae.jpg)

模块说明\Descriptions

1.电源开关

5.MCU I/O□

9.Download按键

13.MCU电源排针

2.稳压芯片

6.电源排针

10.KEY按键

14.主控MCU

3.USB接□

7.DEBUG接□

11.KEY和LED排针

4.USB接□

8.复位按键

以上 CH32V307 评估板配有以下资源：

主板 - CH32V307EVT

1. 开关 S1 ：用于切断或连接外部 5V 供电或 USB 供电  
2. 正向低压降稳压芯片 U1：用于实现将 5V 电压转成芯片可用的 3.3V 电源电压  
3. USB 接口 P5、P15 ：主芯片的 USB 通讯接口 PB6、PB7  
4. USB 接口 P4、P14 ：主芯片的 USB 通讯接口 PA11、PA12  
5. MCU I/O 口 P6、P7、P9 ：主控 MCU 的 I/O 引出接口  
6. 电源排针 P3 ：5V、3.3V、GND 外供电电源排针

7. 调试接口 P10 ：用于下载、仿真调试  
8. 按键 S3 ：复位按键，用于外部手动复位主 MCU  
9. 按键 S4 ：Download 按键，用于从 BOOT 启动下载  
10. 按键 S2 ：通过 P1 排针连接主控 MCU 的 IO 口进行按键控制  
11. KEY 和 LED 排针 P1 ：P1 排针连接主控 MCU 的 IO，控制 LED 和 KEY  
12.网口 ：主芯片的网络通讯接口  
13. MCU 电源排针 P11 ：用于主 MCU 供电选择  
14. 主控 MCU ：CH32V307VCT6

![](images/73fab25be1f0d91c0248b1e9a326de1eaf79d3cd1b940d42cb0e1302ef0e7be0.jpg)  
CH32V307 评估板\CH32V307 Evaluation

### 模块说明\Descriptions

1、网口

5、ARDUINO 接口

9、WCH_LinkE IAP 按键

13、USER 按键

2、USB 高速接口

6、复位按键

10、WCH_LinkE 接口

14、LED

3、MCU I/O

7、WCH-LinkE 指示灯

11、SDI&UART 接口

15、稳压芯片

4、主控 MCU

8、电源开关

12、WCH-LinkE MCU

16、USB 全速接口

上图 CH32V307V 评估板配有以下资源：

主板 - CH32V307EVT-R1

1. 网口：主芯片的网络通讯接口  
2. USB 接口 P6：连接主芯片 USB 高速通信接口  
3. MCU I/O 口 : 主控 MCU 的 I/O 引出接口  
4. 主控 MCU ：CH32V307VCT6  
5. ARDUINO 接口：方便连接 ARDUINO 接口的开发板

6. 复位按键：用于外部手动复位主控 MCU  
7. WCH-LinkE 指示灯：指示 WCH-LinkE 运行状态  
8. 电源开关 S3 ：用于切断或连接外部 5V 供电或 USB 供电  
9. WCH_LinkE IAP 按键: WCH_LinkE 升级按键   
10. WCH-LinkE 接口 ：用于连接 PC 和 WCH-LinkE 功能模块  
11. SDI&UART 接口 ：用于下载、仿真调试，需跳线选择是否使用板载 WCH-LinkE  
12. WCH-LinkE MCU ：实现 WCH-LinkE 功能的 MCU  
13. USER 按键 S2 ：通过 J3 插针连接主控 MCU 的 IO 口进行按键控制  
14. LED ：通过 J3 插针连接主控 MCU 的 IO 口进行控制  
15. 稳压芯片 U1 ：用于实现将 5V 电压转成芯片可用的 3.3V 电源电压  
16. USB 接口 P7：连接主芯片 USB 全速通信接口

![](images/7a8f2dc83461694d356136501263dc3a1d78f4f371fe8c997d5d627a04e93eee.jpg)  
CH32V307 评估板\CH32V307 Evaluation

### 模块说明\Descriptions

1、USB 高速接口

4、电源开关

7、摄像头接口

10、主控 MCU

2、网口

5、DEBUG 接口

8、SD 卡座

11、复位按键

3、USB 全速接口

6、用户按键

9、屏幕接口

CH32V307V-R2 EVT 板配有以下资源：

主板 - CH32V307V-R2

1. USB 接口 P11：连接主芯片 USB 高速通信接口  
2. 网口：主芯片的网络通讯接口(千兆)  
3. USB 接口 P9：连接主芯片 USB 全速通信接口

4. 电源开关 S2 ：用于切断或连接外部 5V 供电或 USB 供电  
5. DEBUG 接口：用于下载、仿真调试  
6. 按键：用户按键  
7. 摄像头接口 P10：实现 MCU 外接摄像头（DVP-8bits）  
8. SD 卡座 P7 ：连接 SDIO 接口，演示通过 SDIO 接口操作 TF 卡  
9. 屏幕接口 P3：实现 MCU 外接 SPI 口显示屏  
10. 主控 MCU ：CH32V307VCT6  
11. 复位按键 S1：用于外部手动复位主控 MCU

![](images/3e33e6efa1b93b533531645ab9618e1b11bf9db6b9c7927cbd57f5308e363673.jpg)  
CH32V307 评估板\CH32V307 Evaluation

### 模块说明\Descriptions

1、网口

4、主控 MCU

7、电源开关

2、MCU I/O

5、USB 全速接口

8、复位按键

3、调试接口

6、USB 高速接口

9、Download 按键

以上 CH32V307 – R3 评估板配有以下资源：

主板 - CH32V307EVT - R3

1. 网口：主芯片的网络通讯接口(百兆)  
2. MCU I/O 口 : 主控 MCU 的 I/O 引出接口  
3. 调试接口：用于下载、仿真调试  
4. 主控 MCU：CH32V307VCT6  
5. USB 接口 P9，P5：连接主芯片 USB 全速通信接口  
6. USB 接口 P11：连接主芯片 USB 高速通信接口

7. 开关 S2 ：用于切断或连接外部 5V 供电或 USB 供电  
8. 按键 S1 ：复位按键，用于外部手动复位主 MCU  
9. 按键 S8 ：Download 按键，用于从 BOOT 启动下载

![](images/05466167104cfaaaa28ddf81a0c49b287409337ea7b65b4120243cbf98a6bb57.jpg)  
CH32V305 评估板\CH32V305 Evaluation

### 模块说明\Descriptions

1、MCU

2、电源开关

3、复位按键

4、调试接口

5、LED

6、USB 接口

以上 CH32V305 评估板配有以下资源：

主板 - CH32V305EVT

1. 主控 MCU：CH32V305GBU6  
2. 开关 S2 ：用于切断或连接外部 5V 供电或 USB 供电  
3. 按键 S1 ：复位按键，用于外部手动复位主 MCU  
4. 调试接口：用于下载、仿真调试  
5. LED ：通过插针连接主芯片 IO 口进行控制  
6. USB 接口 P7，P8 ：主芯片的 USB 通讯接口 PB6、PB7

![](images/0f83ebe4e3f17a7f41781d30e6ea2d00893496dc078e1c24cb914ae6c1711db5.jpg)  
CH32V303 评估板\CH32V303 Evaluation

### 模块说明\Descriptions

1、MCU

4、USB 接口

7、调试接口

2、启动模式配置

5、电源开关

8、复位按键

3、MCU I/O

6、LED

以上 CH32V303 评估板配有以下资源：

主板 - CH32V303EVT

1.主控 MCU：CH32V303CBT6   
2.启动模式配置 P3 ：通过配置 BOOT0/1 来选择芯片上电时的启动模式  
3.MCU I/O 口 P1、P2 ：主控 MCU 的 I/O 引出接口  
4.USB 接口 P6 ：主芯片的 USB 通讯接口 PB6、PB7  
5.开关 S2 ：用于切断或连接外部 5V 供电或 USB 供电  
6.LED ：通过插针连接主芯片 IO 口进行控制  
7.调试接口：用于下载、仿真调试  
8.按键 S1 ：复位按键，用于外部手动复位主 MCU

CH32V303 评估板\CH32V303 Evaluation

![](images/d991ffe11fc7becec06060212f9efe9b48a5a024aa9b07adbc6f7cbb1d890641.jpg)

### 模块说明\Descriptions

1、主控 MCU

4、DEBUG 接口

7、稳压芯片

10、KEY 和 LED 排针

2、MCU I/O

5、MCU 电源排针

8、电源开关

11、KEY 按键

3、复位按键

6、电源排针

9、USB 接口

12、Download 按键

以上 CH32V303 评估板配有以下资源：

主板 - CH32V303EVT

1. 主控 MCU ：CH32V303VCT6  
2. MCU I/O 口 P6、P7、P9 ：主控 MCU 的 I/O 引出接口  
3. 按键 S3 ：复位按键，用于外部手动复位主 MCU  
4. 调试接口 P10 ：用于下载、仿真调试  
5. MCU 电源排针 P11 ：用于主 MCU 供电选择  
6. 电源排针 P3 ：5V、3.3V、GND 外供电电源排针  
7. 正向低压降稳压芯片 U1：用于实现将 5V 电压转成芯片可用的 3.3V 电源电压  
8. 开关 S1 ：用于切断或连接外部 5V 供电或 USB 供电  
9. USB 接口 P4、P14 ：主芯片的 USB 通讯接口 PA11、PA12  
10. KEY 和 LED 排针 P1 ：P1 排针连接主控 MCU 的 IO，控制 LED 和 KEY  
11.按键 S2 ：通过 P1 排针连接主控 MCU 的 IO 口进行按键控制  
12. 按键 S4 ：Download 按键，用于从 BOOT 启动下载

CH32V303 评估板\CH32V303 Evaluation

![](images/d248ca4a0d52bc023aa9c4bc5c1bc3b3cba91754ae734377d55e16a7621ee595.jpg)

### 模块说明\Descriptions

1、主控 MCU

4、DEBUG 接口

7、USB 接口

10、Download 按键

2、MCU I/O

5、电源开关

8、网口

11、KEY 按键

3、电源排针

6、USB 接口

9、KEY 和 LED 排针

12、启动模式配置

13、复位按键

以上 CH32V30x 评估板配有以下资源：

主板 - CH32V30xEVT

1. 主控 MCU ：CH32V303WCU6  
2. MCU I/O 口 P6、P7 ：主控 MCU 的 I/O 引出接口  
3. 电源排针 ：用于主 MCU 供电选择  
4. 调试接口 P10 ：用于下载、仿真调试  
5. 电源开关 S1 ：用于切断或连接外部 5V 供电或 USB 供电  
6. USB 接口 P5、P15 ：主芯片的 USB 通讯接口 PB6、PB7  
7. USB 接口 P4、P14 ：主芯片的 USB 通讯接口 PA11、PA12  
8. 网口：主芯片的网络通讯接口  
9. KEY 和 LED 排针 P1 ：P1 排针连接主控 MCU 的 IO，控制 LED 和 KEY  
10. 按键 S4 ：Download 按键，用于从 BOOT 启动下载  
11.按键 S2 ：通过 P1 排针连接主控 MCU 的 IO 口进行按键控制  
12.启动模式配置：通过配置 BOOT0/1 来选择芯片上电时的启动模式  
13.按键 S3 ：复位按键，用于外部手动复位主 MCU

CH32V305 评估板\CH32V305 Evaluation

![](images/f6633aeeac1b462f0b68fec7ffb95f75d0800eafa96e517e2ee2e6f24ff1e7ae.jpg)

### 模块说明\Descriptions

1. 主控 MCU

2. USB 接口

3. DEBUG 接口

4. LED 排针

5. 复位按键

6. 电源开关

以上 $\mathtt { C H 3 2 V 3 0 x }$ 评估板配有以下资源：

主板 - CH32V30xEVT

1.主控 MCU：CH32V305FBP6   
2.USB 接口：主芯片的 USB 通讯接口  
3.调试接口：用于下载、仿真调试  
4.LED 排针：排针连接主控 MCU 的 IO，控制 LED  
5.复位按键：复位按键，用于外部手动复位主 MCU  
6.电源开关：用于切断或连接外部 5V 供电或 USB 供电

CH32V317 评估板\CH32V317 Evaluation

![](images/d427e9b68199bcaeb425137ee47919a7f2582230a95f6bc27e64fa14d6be5d33.jpg)

### 模块说明\Descriptions

1. 主控 MCU

2. 调试接口

3. USBFS

4. USBHS

5. 电源开关

6. 启动模式配置

7. 复位按键

8. Key 按键

9. 网口

以上 CH32V317 评估板配有以下资源：

主板 - CH32V317EVT

1.主控 MCU：CH32V317WCU6   
2.调试接口：用于下载、仿真调试  
3. USBFS： USBFS 通讯接口 PA11、PA12  
4. USBHS： USBHS 通讯接口 PB6、PB7  
5. 电源开关：用于切断或连接外部 5V 供电或 USB 供电  
6. 启动模式配置：通过配置 BOOT0 来选择芯片上电时的启动模式  
7. 复位按键：复位按键，用于外部手动复位主控 MCU  
8. Key 按键：通过 Key 排针连接主控 MCU 的 IO 口进行按键控制  
9. 网口：主芯片的网络通讯接口

## 三、软件开发

### 3.1 EVT 包目录结构

![](images/7fefaa89ea7cdd25480e3cde70d63a457019b97970c2b25b6c6f8955168a67bb.jpg)

说明：

PUB 文件夹：提供了评估板说明书、评估板原理图。

EXAM 文件夹：提供了 CH32V307 控制器的软件开发驱动及相应示例，按外设分类。每类外设文件夹内包含了一个或多个功能应用例程文件夹。

### 3.2 IDE 使用 –MounRiver

下载 MounRiver_Studio，双击安装，安装后即可使用。（MounRiver_Studio 使用说明详见,路径：MounRiver\MounRiver_Studio\ MounRiver_Help.pdf 和 MounRiver_ToolbarHelp.pdf）

#### 3.2.1 打开工程

####  打开工程：

1）在相应的工程路径下直接双击.wvproj 后缀名的工程文件；  
2）在 MounRiver IDE 中点击 File，点击 Load Project，选择相应路径下.project 文件，点击Confirm 应用即可。

#### 3.2.2 编译

MounRiver 包含三个编译选项，如下图所示：

![](images/76bb6f367ba55f131d71bb092a07f3d76f0557b75469a56de7f9334a9ee14123.jpg)

编译选项 1 为增量编译，对选中工程中修改过的部分进行编译；

编译选项 2 为 ReBuild，对选中工程进行全局编译；

编译选项 3 为 All Build，对所有的工程进行全局编译。

#### 3.2.3 下载/仿真

####  下载

#### 1）调试器下载

通过 WCH-Link 连接硬件（WCH-Link 使用说明详见,路径：MounRiver\MounRiver_Studio\ WCH-Link 使用说明.pdf），点击 IDE 上 Download 按钮，在弹出的界面选择下载，如下图所示：

![](images/fe9238d875368bd22124e12af5d0361591635d27bd7f40e3f9985c14bba6c672.jpg)

1 为查询芯片读保护状态；  
2 为设置芯片读保护，重新上电配置生效；  
3 为解除芯片读保护，重新上电配置生效；

#### 2）WCHISPTool 下载

使用 WCHISPTool 工具对芯片进行下载，支持 USB 和串口两种下载方式。USB 管脚为 PA11（DM）、PA12（DP）或 PB6（DM）、PB7（DP），串口管脚为 PA9(TX)、PA10（RX）。下载流程为：

(1) BOOT0 接 VCC，BOOT1 接地，通过串口或者 USB 连接 PC；  
(2) 打开 WCHISPTool 工具，选择相应下载方式，选择下载固件，勾选芯片配置，点击下载；  
(3) BOOT0 接地，重新上电，运行 APP 程序。

WCHISPTool 工具界面如图所示：

![](images/51edbb1d5892860af29c3e04bef206080f4805738154f7d26441f0c4314ae864.jpg)

####  仿真

#### 打开 MounRiver Studio 软件进行调试配置

![](images/ad90f24960687ca43bd6fac17d18dcfe2c5b41ac9cc6be98a8e8e08fc28c53e2.jpg)

#### 1）工具栏说明

点击菜单栏的调试按键进入下载，见下图所示，下载工具栏

![](images/8b70c29ef755a570b03e145a9ecc21493abf476019b19845bdc76cfa7123463f.jpg)

详细功能如下：

1.复位（Restart）：复位之后程序回到最开始处。  
2.继续：点击继续调试。

3.终止：点击退出调试。  
4.单步跳入：每点一次按键，程序运行一步，遇到函数进入并执行。  
5.单步跳过：跳出该函数，准备下一条语句。  
6.单步返回：返回所跳入的函数  
7.指令集单步模式：点击进入指令集调试（需与 4、5、6 功能配合使用）。

#### 2）设置断点

双击代码左侧可设置断点，再次双击取消断点，设置断点如下图所示;

![](images/b5c290678983229bdcd70c187a5089c486d51ac87b5a5a1e88d5f36bc1abdf9b.jpg)

#### 3）界面显示

#### （1）指令集界面

点击指令集单步调试可进入指令调试，以单步跳入为例，每点击一次，可运行一次，运行光标会发生移动，以查看程序运行，指令集界面如下图所示：

![](images/8f3759f2aa63bbd6c8b5dcb70fa2578b01884f93d41757c2e28e3ebe34c4da22.jpg)

#### （2）程序运行界面

可与指令集单步调试配合使用，仍以单步跳入为例，每点击一次，可运行一次，运行光标会发生移动，以查看程序运行，程序运行界面如下图所示：

```txt
133 int main(void)  
134 {  
135 u16 adc_val;  
136 u16 adc_jval;  
137  
138 Delay_Init();  
139USART(Printf_Init(115200);  
140 printf("SystemClk:%d\r\n", SystemCoreClock);  
141  
142 ADC_Function_Init();  
143 printf("CalibratrationValue:%d\n", Calibratration_VAL);  
144  
145 while(1)  
146 {  
147 ADC_SoftwareStartConvCmd(ADC1, ENABLE);  
148 while(!ADC_GetFlagStatus(ADC1, ADC_FLAG_EOC));  
149 adc_val = ADC_GetConversionValue(ADC1);  
150 adc_jval = ADC_GetInjectedConversionValue(ADC1, ADC_InjectedChannel_1);  
151 Delay_Ms(500);  
152 printf("val:%04d\r\n", Get_ConversionVal(adc_val));  
153 printf("jval:%04d\n", Get_ConversionVal(adc_jval));  
154 Delay_Ms(2);  
155 }  
156 }  
157 
```

#### 4）变量：

鼠标悬停在源码中变量之上会显示详细信息，或者选中变量，然后右键单击 add watchexpression

![](images/f731bfe9adfcd7fb29dc05377abacd412fa903cc857a2b3988b4d4182dc82f96.jpg)

填写变量名 ，或者直接点击 OK，将刚才选中的变量加入到弹出的：

![](images/be657eaeda3eca4c81b288fe0f3cf640b263c302f11f8be260f1e823a49bad63.jpg)

#### 5）外设寄存器

在 IDE 界面左下角 Peripherals 界面显示有外设列表，勾选外设则在 Memory 窗口显示其具体的寄存器名称、地址、数值。

![](images/b2f2be7dab262d6a1d9e4ddc1b88ad4e39378e7c86ee3696354571345cb19cce.jpg)

![](images/c4e58dfc00c63c0537c35ee2307a35a3a39e0d1e40cf2b35170953fdc1aecb0a.jpg)

注明：(1)调试时，点击右上角图标可进入原始界面。

![](images/78de82419fc745bd13d0932e3bae243bfc5d13d6e59a4a3b9e1e3e09fdc80474.jpg)

(2)有关文档进入编译器，点击 F1 可进入帮助文档，可查看详细说明。

####  工程芯片选型

在历程工程中有多种芯片选型，以 CH32V307 开发板所用芯片 CH32V307VCT6 为例进行工程芯片选择编译，已实现不同外设功能，步骤如下：

1）点击 Peripheral—>inc 文件夹下的 ch32v30x.h 文件进行芯片类型的勾选，如下图所示，因选用芯片类型为 CH32V307VCT6，因此选用 CH32V30x_D8C。（注：若使用 $\mathtt { C H 3 2 V 3 0 3 x }$ 系列芯片选用 CH32V30x_D8）

![](images/dac9f68cd753b1c46a400d9a0cdf38d32c075122e73b18d26c242b041e1f0a37.jpg)

![](images/911de2b9593979838b69dceea17a114514e031d2bc73bec570ae0cb85730f352.jpg)

2）选择启动文件，点击 Startup 文件夹，选用定义所对应的启动文件，如下图所示，因步骤 1选用 CH32V30x_D8C，因此选用 startup_ch32v30x_D8C.S 文件（注：若使用 $\mathtt { C H 3 2 V 3 0 3 x }$ 系列芯片选用 startup_ch32v30x_D8.S）

![](images/bb1fa48cbd378497e515a07822cf5b79599bb913756ef05681a33a2c9efef72b.jpg)

注明：在工程不使用的文件中，如在文件夹内文件点击删除后，会导致文件直接删除至回站，再次使用时需重新编译才可，因此对无使用的文件建议使用参与/排除编译功能，以对 Startup 文件夹中编译/排除进行简要说明。首先选用工程点击右键，选用参与/排除编译功能按键，以图中startup_ch32v30x_D8.S 文件为例，如工程状态为排除编译，点击本功能即可为参与编译。反正，如工程状态为参与编译，点击本功能即可为排除编译。同样，文件夹也可适用。

![](images/387135644ae8b1c16dfb925f57a9a9822a924e1d0f9aeff97b22a1626bdd4c15.jpg)

## 四、WCH-LinkUtility.exe 下载

使用 WCH-LinkUtility 工具对芯片进行下载流程为：

1）连接 WCH-Link；  
2）选择芯片信息；  
3）添加固件；  
4）设置配置，若芯片为读保护需解除芯片读保护；  
5）执行

![](images/3c2cb89948513814cdd53e92d1deb1e377be5d5fc644ebe5c95448517c07b58d.jpg)

## 五、WCHISPTool.exe 下载

使用 WCHISPTool 工具对芯片进行下载，支持 USB 和串口两种下载方式。USB 管脚为 PA11（DM）、PA12（DP）或 PB6（DM）、PB7（DP），串口管脚为 PA9(TX)、PA10（RX）。下载流程为：

1）BOOT0 接 VCC，BOOT1 接地，通过串口或者 USB 连接 PC；  
2）打开 WCHISPTool 工具，选择相应下载方式，选择下载固件，勾选芯片配置，点击下载；  
3）BOOT0 接地，重新上电，运行 APP 程序。

WCHISPTool 工具界面如图所示：

![](images/73c5c830734187193ab02153f209c6492c73ecfb1598923411b4a1825ab4feb4.jpg)

1.选择 MCU 系列和芯片型号；  
2.选择 USB 或串口下载方式；  
3. 识别设备，一般自动识别，如未能识别，需手动选择；  
4. 选择固件，选择下载的.hex 或.bin 目标程序文件；  
5.根据要求进行下载配置；  
6.点击下载。

## 六、声明注意

沁恒微电子社区：https://www.wch.cn/bbs/forum-106-1.html

沁恒官网：https://www.wch.cn/

WCH-Link 使用说明：https://www.wch.cn/products/WCH-Link.html